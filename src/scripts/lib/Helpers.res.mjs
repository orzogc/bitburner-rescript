// Generated by ReScript, PLEASE EDIT WITH CARE


function crawlServers(ns, excludePurchasedServersOpt, excludeHomeOpt) {
  var excludePurchasedServers = excludePurchasedServersOpt !== undefined ? excludePurchasedServersOpt : false;
  var excludeHome = excludeHomeOpt !== undefined ? excludeHomeOpt : true;
  var servers = new Set();
  var getServers = function (_server, remains) {
    while(true) {
      var server = _server;
      if (servers.has(server)) {
        var s = remains.values().next().value;
        if (s === undefined) {
          return ;
        }
        remains.delete(s);
        _server = s;
        continue ;
      }
      servers.add(server);
      ns.scan(server).forEach(function (s) {
            remains.add(s);
          });
      continue ;
    };
  };
  getServers(ns.getHostname(), new Set());
  if (excludePurchasedServers) {
    ns.getPurchasedServers().forEach(function (s) {
          servers.delete(s);
        });
  }
  if (excludeHome) {
    servers.delete("home");
  }
  return servers;
}

function getRootAccess(ns, host) {
  var info = ns.getServer(host);
  if (info.hasAdminRights) {
    ns.print("INFO: server " + host + " has root access already");
    return true;
  }
  var match = info.openPortCount;
  var match$1 = info.numOpenPortsRequired;
  if (match !== undefined && match$1 !== undefined) {
    if (match < match$1) {
      if (!info.sshPortOpen && ns.fileExists("BruteSSH.exe", "home")) {
        ns.brutessh(host);
      }
      var info$1 = ns.getServer(host);
      if (info$1.openPortCount < info$1.numOpenPortsRequired && !info$1.ftpPortOpen && ns.fileExists("FTPCrack.exe", "home")) {
        ns.ftpcrack(host);
      }
      var info$2 = ns.getServer(host);
      if (info$2.openPortCount < info$2.numOpenPortsRequired && !info$2.smtpPortOpen && ns.fileExists("relaySMTP.exe", "home")) {
        ns.relaysmtp(host);
      }
      var info$3 = ns.getServer(host);
      if (info$3.openPortCount < info$3.numOpenPortsRequired && !info$3.httpPortOpen && ns.fileExists("HTTPWorm.exe", "home")) {
        ns.httpworm(host);
      }
      var info$4 = ns.getServer(host);
      if (info$4.openPortCount < info$4.numOpenPortsRequired && !info$4.sqlPortOpen && ns.fileExists("SQLInject.exe", "home")) {
        ns.sqlinject(host);
      }
      
    }
    var info$5 = ns.getServer(host);
    if (info$5.openPortCount >= info$5.numOpenPortsRequired) {
      if (ns.fileExists("NUKE.exe", "home")) {
        ns.nuke(host);
        var info$6 = ns.getServer(host);
        if (info$6.hasAdminRights) {
          ns.print("SUCCESS: server " + host + " has root access now");
          return true;
        } else {
          ns.print("ERROR: failed to get root access on server " + host);
          return false;
        }
      }
      ns.print("ERROR: no NUKE.exe on home server");
      return false;
    }
    ns.print("ERROR: failed to get root access on server " + host + " because of no enough ports opened");
    return false;
  }
  ns.print("ERROR: no ports to open on server " + host);
  return false;
}

function getHomeCores(ns) {
  return ns.getServer("home").cpuCores;
}

export {
  crawlServers ,
  getRootAccess ,
  getHomeCores ,
}
/* No side effect */
